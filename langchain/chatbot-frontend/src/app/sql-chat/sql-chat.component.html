<div class="app-container">
  <aside class="sidebar">
    <h3>ğŸ“š Bases de donnÃ©es</h3>
      <select [(ngModel)]="selectedDb" (change)="onDbChange()">
        <option *ngFor="let db of databases" [value]="db">{{ db }}</option>
      </select>

      <ul class="tree">
        <li *ngFor="let table of schema | keyvalue">
          <div (click)="toggleTable(table.key)" class="table-name">
            {{ table.key }}
            <span>{{ expandedTables.has(table.key) ? 'â–¼' : 'â–¶' }}</span>
          </div>
          <ul *ngIf="expandedTables.has(table.key)" class="columns-list">
            <li *ngFor="let col of table.value">{{ col }}</li>
          </ul>
        </li>
      </ul>
  </aside>

  <main class="chat-area">
    <div class="chat-header">ğŸ§  Chat SQL</div>

    <div class="chat-messages" *ngIf="messages.length; else noMessages">
      <div *ngFor="let msg of messages" class="chat-message">
        <div><strong>â“ Question :</strong> {{ msg.question }}</div>

        <div class="response-split">
          <div class="response-text">
            <h4>ğŸ’¬ RÃ©ponse :</h4>
            <pre>{{ msg.reponse_sql }}</pre>
          </div>
          <div class="sql-text">
            <h4>ğŸ§  RequÃªte SQL :</h4>
            <pre>{{ msg.requete_sql }}</pre>
          </div>
        </div>
      </div>
    </div>

    <ng-template #noMessages>
      <p>Aucune question posÃ©e pour l'instant.</p>
    </ng-template>

    <div class="chat-input">
      <input [(ngModel)]="question" placeholder="Pose ta question..." />
      <button (click)="poserQuestion()" [disabled]="loading || !selectedDb || !question.trim()">
        {{ loading ? '...' : 'Envoyer' }}
      </button>
    </div>
  </main>
</div>
